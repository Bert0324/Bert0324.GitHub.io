<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Bert's Blog</title><meta name="keywords" content="blog,javascript,typescript,code,frontend"><meta name="description" content="bert huang's blog"><link rel="icon" href="/assets/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/github-markdown-css/4.0.0/github-markdown.min.css" integrity="sha512-Oy18vBnbSJkXTndr2n6lDMO5NN31UljR8e/ICzVPrGpSud4Gkckb8yUpqhKuUNoE+o9gAb4O/rAxxw1ojyUVzg==" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.6.0/styles/a11y-light.min.css" integrity="sha512-PW96n2amVglidqEDLPUdjJ0zByhT20poSqWJYZRutR6CP2QH58k96WmorqNnC4QXnosNeqMJM8FR/93isIifDQ==" crossorigin="anonymous"><link rel="stylesheet" href="/blog/style.css"></head><body><div><div class="container"><div class="side-bar"><img class="avatar" src="/assets/avatar.jpeg"><h1>Bert Huang</h1><p>一位兴趣广泛的前端程序员</p><nav><ul><li><a href="/blog/index.html">Index</a></li><li><a href="/blog/code.html">Code</a></li><li><a href="/blog/leetcode.html">LeetCode</a></li><li><a href="/blog/essay.html">Essay</a></li><li><a href="/blog/about.html">About</a></li></ul></nav><div id="social"><a href="https://github.com/Bert0324"><img class="social-avatar" src="https://github.githubassets.com/favicons/favicon.png"></a><a href="https://www.facebook.com/people/Yuchen-Huang/100005315205237"><img class="social-avatar" src="/assets/facebook.png"></a><a href="https://twitter.com/BertHuang5"><img class="social-avatar" src="/assets/twitter.png"></a></div><div class="views-count"><p id="busuanzi_container_site_uv" style="display:inline">total viewers: <span id="busuanzi_value_site_uv"></span></p></div></div><div class="post-content"><div class="search-field"><input class="search-input" placeholder="search"><div style="position:absolute"><div class="search-dropdown"><div class="dropdown-container"></div></div></div><button class="icon-font search-button"></button></div><div class="post-container"><div id="particles-js" style="position:fixed;height:100vh;width:100vw;z-index:-99"></div><div class="post-article"><article class="markdown-body"><div><div id="toc"><div class="last-edit"><p>Last Commit: 2021-10-05 14:42:58</p><p id="busuanzi_container_page_pv">views: <span id="busuanzi_value_page_pv"></span></p></div><div id="toc-body"><p><strong>Table of Content</strong></p><ul><li><a href="#why%20we%20need%20https">why we need https</a></li><li><a href="#steps">steps</a></li><li><a href="#certificate%20validation">certificate validation</a></li><li><a href="#measure%20tls%20time%20by%20curl">measure tls time by curl</a></li><li><a href="#use%20wireshark%20to%20capture%20tls%20connection">use wireshark to capture tls connection</a></li><li><a href="#reference">reference</a></li></ul></div></div><div><h1 id="https">Https</h1><p>Hypertext transfer protocol secure (HTTPS) is the secure version of HTTP, which is the primary protocol used to send data between a web browser and a website.</p><h2 id="why%20we%20need%20https">Why we need Https</h2><p>Http use plain text to transmit data. When we are connecting with a unsecured medium, such as public Wi-Fi, the data can be sniffed by some of software.</p><p>It is harmful especially when the data is sensitive, such as password or bank number.</p><p>With HTTPS, traffic is encrypted by SSL such that even if the packets are sniffed or otherwise intercepted, they will come across as nonsensical characters.</p><p>As the client uses public key to encrypt message, and the server uses private key to decrypt it.</p><h2 id="steps">Steps</h2><p>A Https handshake includes 5 steps as below:</p><img src="https://raw.githubusercontent.com/Bert0324/code-playground/master/assets/ssl_handshake.jpg" width="400"><ol><li><p>The client sends a request to the server for a secure session. The server responds by sending its X.509 digital certificate to the client.</p></li><li><p>The client receives the server&#39;s X.509 digital certificate.</p></li><li><p>The client authenticates the server, using a list of known certificate authorities.</p></li><li><p>The client generates a random symmetric key and encrypts it using server&#39;s public key.</p></li><li><p>The client and server now both know the symmetric key and can use the SSL encryption process to encrypt and decrypt the information contained in the client request and the server response.</p></li></ol><p>So in fact, Https use this symmetric key to encrypt and decrypt data both in the client and the server. As symmetric encryption which is used through the rest is faster and more efficient with large amounts of data transfer. The keys are smaller which is generally why it&#39;s faster, but it&#39;s algorithm is also easier to process.</p><p>The handshake is as below:</p><img src="https://raw.githubusercontent.com/Bert0324/code-playground/master/assets/tls_handshake.png" width="400"><h2 id="certificate%20validation">Certificate Validation</h2><p>As we can see, a Https connection is based on Http connection, the key point it can guarantee security is Certificate. So, how the client to verify a certificate is valid?</p><ol><li><p>Browser downloads the web server&#39;s certificate. This certificate is signed with the private key of a trusted certificate (GlobalSign Org) authority.</p></li><li><p>Browser comes installed with the public keys of all of the major certificate authorities. It uses this public key to verify that the web server&#39;s certificate was indeed signed by the trusted certificate authority.</p></li><li><p>The certificate contains the domain name and/or ip address of the web server. Browser confirms with the certificate authority that the address listed in the certificate is the one to which it has an open connection.</p></li></ol><h2 id="measure%20tls%20time%20by%20curl">Measure TLS time by <code>curl</code></h2><p>When using SSR, the shell as below:</p><pre><code class="language-shell">curl -w &quot;TCP handshake: %{time_connect}, SSL handshake: %{time_appconnect}\n&quot; -I --socks5 127.0.0.1:1086 https://www.google.com
</code></pre><h2 id="use%20wireshark%20to%20capture%20tls%20connection">use Wireshark to capture TLS connection</h2><ol><li>export <code>SSLKEYLOGFILE</code></li></ol><ul><li><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Projects/NSS/Key_Log_Format">https://developer.mozilla.org/en-US/docs/Mozilla/Projects/NSS/Key_Log_Format</a></li></ul><ol start="2"><li>append <code>SSLKEYLOGFILE</code> path to Wireshark</li></ol><p>As below:</p><h2 id="reference">Reference</h2><ul><li><a href="https://www.ibm.com/support/knowledgecenter/en/SSZHJ2_9.1.0/securing/topics/sslauth.html">https://www.ibm.com/support/knowledgecenter/en/SSZHJ2_9.1.0/securing/topics/sslauth.html</a></li><li><a href="https://robertheaton.com/2014/03/27/how-does-https-actually-work/">https://robertheaton.com/2014/03/27/how-does-https-actually-work/</a></li><li><a href="https://www.cnblogs.com/yincheng/p/https.html">https://www.cnblogs.com/yincheng/p/https.html</a></li><li><a href="https://www.venafi.com/education-center/ssl/how-to-check-ssl-certificate">https://www.venafi.com/education-center/ssl/how-to-check-ssl-certificate</a></li></ul></div></div></article></div></div><div id="reminder" style="display:none">Facebook Comments Service is unavailable</div></div></div></div></body><script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script><script async defer="defer" crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v9.0" nonce="BSCiWiHI"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-0SEZ9KRGY7"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script async src="https://cdnjs.cloudflare.com/ajax/libs/FlexSearch/0.6.22/flexsearch.min.js"></script><script src="/blog/index.js"></script></html>